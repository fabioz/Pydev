<doc>
<contents_area>
<div id="Content" style="padding: 5px;">
<h1><a name="PyDevJythonScripting-ScriptingPyDevwithJython"></a>Scripting PyDev with Jython</h1>

<p>Version 1.0.4 has added the option of <b>scripting PyDev with Jython</b>, and this article aims at explaining how it works and how to add your own scripts to PyDev.</p>

<p>What we will see is the integration that will allow you to listen to the events generated by the editor (PyEdit class) and respond accordingly. </p>

<p><b>NOTE</b>: In the end of this article, there are links to view things at the cvs with the referenced classes.</p>

<p>The examples that we will see are located in the project <b>org.python.pydev.jython</b> under the folder <b>jysrc</b>.</p>

<p>The first thing you'll want to do is configure the preferences so that you can see the output of the scripts in the console (so that you can do some prints and actually see them).</p>

<p><span class="image-wrap" style=""><img src="images/scripting/scripting_prefs.png" style="border: 1px solid black" /></span></p>

<p>Now that you have your preferences correctly set, let's make some changes to see what we can play with... You just need PyDev installed (we will change the scripts that come with the default installation, so, there is no need to actually download the PyDev sources, altough it might be worth getting it for having it as a reference).</p>

<p>So, in your PyDev installation, go to the <b>jysrc</b> folder of the <b>org.python.pydev.jython plugin</b> that is part of PyDev (this is located under the eclipse install... something as <b>.../eclipse/plugins/org.python.pydev.jython&#95;1.0.4/jysrc</b>)</p>

<p>You'll notice some files that start with <b>pyedit&#95;</b> (there could be many, but for this article, we'll only care about <b>pyedit&#95;example.py</b>, <b>pyedit&#95;example2.py</b> and <b>pyedit&#95;next&#95;problem.py</b>).</p>

<p>The first thing you want to know about is that the name of the script is something important in the integration. All the scripts that will listen to the PyEdit class (this is the PyDev Editor) have to start with <b>pyedit&#95;</b>. Another interesting thing is that changes are gathered without the need of restarting Eclipse (but as we will be listening to the editor, you might have to reopen it, so that it triggers all of the events we may want to listen).</p>

<p>So, now that you're ready, let's open the file <b>pyedit&#95;example.py</b> and uncomment the last line of code. After, if you close a PyDev Editor and open it again, you'll notice that you'll have some messages showing in the console, with the 'print' statement that was uncommented (and now, if you go and comment it again, you'll stop seeing the messages again, so, you can see that all the <b>changes are automatically reloaded whenever you change the script</b>).</p>

<p><b>TIP</b>: You may just drag and drop files from your filesystem into PyDev to edit those files.</p>

<p>The image below shows the ouput you should get from uncommenting the line in the example above.</p>

<p><span class="image-wrap" style=""><img src="images/scripting/scripting_output.png" style="border: 1px solid black" /></span></p>

<p>Now that you've already seen how 'easy' it should be to change an existing script and get it to work, let's now create our own script.</p>

<p>The first thing you want to do is create a jython project (call it pydev&#95;scripts), then, go to the scripting preferences and put the <b>src</b> directory from that project in the <b>Location of additional scripts</b>.</p>

<p>Now, under the src folder of that project, create a <b>pyedit&#95;test1.py</b> file. Just write <b>print '&gt;&gt;', cmd</b> and save it... When you save it, you'll notice in the console something as:</p>

<blockquote>
<p>---&gt; reloading<br/>
E:/eclipse&#95;testing&#95;workspace/pydev&#95;additional&#95;scripts/src/pyedit&#95;test1.py<br/>
&gt;&gt; onSave</p></blockquote>

<p>You will receive (currently) 4 commands:</p>

<ul class="alternate" type="square">
	<li><b>onSetDocument</b>: You can then link your commands to listen to changes in the document if you want (besides the standard 'editor' and 'cmd' variables, you will also be able to have access to a 'document' variable (it is an IDocument).</li>
	<li><b>onCreateActions</b>: It is called only once when the actions are being created. You should handle it to add your own actions in the PyEdit (the pyedit&#95;example2.py shows the default way of doing this)</li>
	<li><b>onSave</b>: want to do something when the PyEdit saves its content? That's your chance...</li>
	<li><b>onDispose</b>: Called when the PyEdit is going to dispose itself.</li>
</ul>


<p>And that's it. We've seen how to create scripts and make PyDev load them for editor actions. If you want to keep on, you should check some example scripts that come with PyDev (those come in the org.python.pydev.jython&#95;xxx/jysrc folder &#8211; there are links to them in the resources section in the end of this page). You should check:</p>

<ul class="alternate" type="square">
	<li><b>pyedit&#95;example.py</b>: this is the simple example we covered here, to see the output of the commands we have</li>
	<li><b>pyedit&#95;example2.py</b>: this is an example on how to bind some action to the <b>'default' keybindig structure</b> that is provided by PyDev for jython scripts.</li>
	<li><b>pyedit&#95;next&#95;problem.py</b>: This is the implementation of the <b>go to next problem</b> that is implemented at PyDev. <b>Disclaimer</b>: the way it binds to the keybinding would require you to change the plugin.xml as it is based on the Eclipse structure, which is much more static than the way of binding things to the PyDev editor presented to you on pyedit&#95;example2.py (it would require changes in the plugin.xml file of the plugin, but on the other way, it would also allow you to change the keybinding for it).</li>
</ul>


<p><b>IMPORTANT NOTES:</b></p>

<ul class="alternate" type="square">
	<li>The directories that are added to the <b>PYTHONPATH</b> are the Lib dir from jython and the jysrc dir (both under the org.python.pydev.jython plugin).</li>
	<li>There is <b>one interpreter</b> for each PyEdit, so, while it is not reused across editors, it is <b>reused in the same editor</b>... So, be careful not to mess with global things. Ideally, you should only rely on things that the editor will pass you (such as the editor, the cmd, the document...)</li>
	<li>Some commands rely on having some specific command, so, you might not 'see' the change until you restart the editor (this is the case when registering actions depending on: <b>onCreateActions</b>).</li>
	<li>If you have further doubts about scripting, you can register at the <b>pydev-code</b> list at sourceforge, and ask them there, and if you've been able to create some nice, useful script, you can contribute it back to PyDev by creating a bug and attaching your script there.</li>
</ul>


<p>So, that's it... Happy Scripting!</p>

<p><b>Resources</b> (links to github)</p>

<ul class="alternate" type="square">
	<li><b><a href="https://github.com/fabioz/Pydev/blob/f742ccc87a78a0dbf5fcd618561b3a91cdfbf5f5/plugins/org.python.pydev/src/org/python/pydev/editor/PyEdit.java" class="external-link" rel="nofollow">PyEdit.java </a></b></li>
	<li><b><a href="https://github.com/fabioz/Pydev/tree/f742ccc87a78a0dbf5fcd618561b3a91cdfbf5f5/plugins/org.python.pydev.jython/jysrc" class="external-link" rel="nofollow">org.python.pydev.jythor/jysrc </a></b></li>
	<li><b><a href="https://github.com/fabioz/Pydev/blob/f742ccc87a78a0dbf5fcd618561b3a91cdfbf5f5/plugins/org.python.pydev/src/org/python/pydev/editor/IPyEditListener.java" class="external-link" rel="nofollow">IPyEditListener.java </a></b></li>
	<li><b><a href="https://github.com/fabioz/Pydev/blob/f742ccc87a78a0dbf5fcd618561b3a91cdfbf5f5/plugins/org.python.pydev/src/org/python/pydev/editor/scripting/PyEditScripting.java" class="external-link" rel="nofollow">PyEditScripting.java </a></b></li>
	<li><b><a href="https://github.com/fabioz/Pydev/blob/f742ccc87a78a0dbf5fcd618561b3a91cdfbf5f5/plugins/org.python.pydev.jython/jysrc/pyedit_example.py" class="external-link" rel="nofollow">pyedit&#95;example.py </a></b></li>
	<li><b><a href="https://github.com/fabioz/Pydev/blob/f742ccc87a78a0dbf5fcd618561b3a91cdfbf5f5/plugins/org.python.pydev.jython/jysrc/pyedit_example2.py" class="external-link" rel="nofollow">pyedit&#95;example2.py </a></b></li>
	<li><b><a href="https://github.com/fabioz/Pydev/blob/f742ccc87a78a0dbf5fcd618561b3a91cdfbf5f5/plugins/org.python.pydev.jython/jysrc/pyedit_wrap_paragraph.py" class="external-link" rel="nofollow">pyedit&#95;wrap&#95;paragraph.py </a></b></li>
</ul>


</div>
</contents_area>
</doc>