<doc>
<contents_area>

	<h3>Scripting PyDev with Jython</h3>
	
	<p>
		Version 1.0.4 has added the option of <strong>scripting PyDev with Jython</strong>, and this article aims at explaining how it works
		and how to add your own scripts to PyDev.
	</p>
	
	<br/>
	<p>
		What we will see is the integration that will allow you to listen to the events generated by the editor (PyEdit class)
		and respond accordingly.<br/>
		<strong>NOTE</strong>: In the end of this article, there are links to view things at the cvs with the referenced classes.
		
	</p>
	
	<br/>
	<p>
		The examples that we will see are located in the project <strong>org.python.pydev.jython</strong> under the folder <strong>jysrc</strong>.
	</p>
	
	<br/>
	<p>
		The first thing you'll want to do is configure the preferences so that you can see the output of the scripts 
		in the console (so that you can do some prints and actually see them).
	</p>
	
	<p><br/><center><img src="images/scripting/scripting_prefs.png"/></center><br/><br/></p>
	<p>
		Now that you have your preferences correctly set, let's make some changes to see what we can play with... You just need
		PyDev installed (we will change the scripts that come with the default installation, so, there is no need to actually download
		the PyDev sources, altough it might be worth getting it for having it as a reference).
	</p>
	
	<br/>
	<p>
		So, in your PyDev installation, go to the <strong>jysrc</strong> folder of the <strong>org.python.pydev.jython plugin</strong>
		that is part of PyDev (this is located under the eclipse install... 
		something as <strong>...\eclipse\plugins\org.python.pydev.jython_1.0.4\jysrc</strong>)
	</p>
	
	<br/>
	<p>
		You'll notice some files that start with <strong>pyedit_</strong> (there could be many, but for this article, we'll only care
		about <strong>pyedit_example.py</strong>, <strong>pyedit_example2.py</strong> and <strong>pyedit_next_problem.py</strong>).
	</p>

	<br/>
	<p>
		The first thing you want to know about is that the name of the script is something important in the integration. All the
		scripts that will listen to the PyEdit class (this is the PyDev Editor) have to start with <strong>pyedit_</strong>. Another
		interesting thing is that changes are gathered without the need of restarting Eclipse (but as we will be listening to
		the editor, you might have to reopen it, so that it triggers all of the events we may want to listen).
	</p>
		
	<br/>
	<p>
		So, now that you're ready, let's open the file <strong>pyedit_example.py</strong> and uncomment the last line of code. 
		After, if you close a PyDev Editor and open it again, you'll notice that you'll have some messages showing in the console, with the 'print'
		statement that was uncommented (and now, if you go and comment it again, you'll stop seeing the messages again, so,
		you can see that all the <strong>changes are automatically reloaded whenever you change the script</strong>).
	</p>
	
	<br/>
	<p>
		<strong>NOTE</strong>: the <a href="http://sunshade.sourceforge.net/update">sunshade</a> plugin may be very useful,
		as it will allow you to open the external files through drag and drop from the explorer itself, as you'll probably not
		have a project for those scripts (unless you want to get the whole PyDev structure and script it in the development version).
	</p>
	<br/>
	
	<p>
		The image below shows the ouput you should get from uncommenting the line in the example above.
	</p>
	<p><br/><center><img src="images/scripting/scripting_output.png"/></center><br/><br/></p>
	
	<p>
		Now that you've already seen how 'easy' it should be to change an existing script and get it to work, let's now
		create our own script.
	</p>
	
	
	<br/>
	<p>
		The first thing you want to do is create a jython project (call it pydev_scripts), then, go to the scripting preferences and put
		the <strong>src</strong> directory from that project in the <strong>Location of additional scripts</strong>.
	</p>

	<br/>
	<p>
		Now, under the src folder of that project, create a <strong>pyedit_test1.py</strong> file. Just write <strong>print '>>', cmd</strong> and save it...
		When you save it, you'll notice in the console something as:<br/>
		<strong>
		--->  reloading E:\eclipse_testing_workspace\pydev_additional_scripts\src\pyedit_test1.py<br/>
		>> onSave<br/>
		</strong>
	</p>	
	
	<br/>
	<p>
		You will receive (currently) 4 commands:
		<ul>
			<li><strong>onSetDocument</strong>: You can then link your commands to listen to changes in the document if you want (besides the standard
				'editor' and 'cmd' variables, you will also be able to have access to a 'document' variable (it is an IDocument).</li>
			<li><strong>onCreateActions</strong>: It is called only once when the actions are being created. You should handle it to add your
			own actions in the PyEdit (the pyedit_example2.py shows the default way of doing this)</li> 
			<li><strong>onSave</strong>: want to do something when the PyEdit saves its content? That's your chance...</li>
			<li><strong>onDispose</strong>: Called when the PyEdit is going to dispose itself.</li>
		</ul>
	</p>
	
		
	<br/>
	<p>
		And that's it. We've seen how to create scripts and make PyDev load them for editor actions. If you want to 
		keep on, you should check some example scripts that come with PyDev 
		(those come in the org.python.pydev.jython_xxx/jysrc folder -- there are links to
		them in the resources section in the end of this page). You should check:<br/>
		
		<ul>
			<li><strong>pyedit_example.py</strong>: this is the simple example we covered here, to see the output of the commands we have</li>
			<li><strong>pyedit_example2.py</strong>: this is an example on how to bind some action to the <strong>'default' keybindig structure</strong> that 
			is provided by PyDev for jython scripts.</li>
			<li><strong>pyedit_next_problem.py</strong>: This is the implementation of the <strong>go to next problem</strong> that is
			implemented at PyDev. <strong>Disclaimer</strong>: the way it binds to the keybinding would require you to change the plugin.xml
			as it is based on the Eclipse structure, which is much more static than the way of binding things to the PyDev editor presented
			to you on pyedit_example2.py (it would require changes in the plugin.xml file of the plugin, but on the other way, it would also
			allow you to change the keybinding for it).
			</li>
		</ul>
		
	</p>
	
	<br/>
	<p>
	<strong>IMPORTANT NOTES:</strong>
		<ul>
			<li>
				The directories that are added to the <strong>PYTHONPATH</strong> are the Lib dir from jython and the jysrc dir (both under the
				org.python.pydev.jython plugin).
			</li>
			<li>
				There is <strong>one interpreter</strong> for each PyEdit, so, while it is not reused across editors, it is <strong>reused in the same editor</strong>...
				So, be careful not to mess with global things. Ideally, you should only rely on things that the editor will pass you
				(such as the editor, the cmd, the document...)
			</li>
			<li>
				Some commands rely on having some specific command, so, you might not 'see' the change until you restart the editor 
				(this is the case when registering actions depending on: <strong>onCreateActions</strong>).
			</li>
			<li>
				If you have further doubts about scripting, you can register at the <strong>pydev-code</strong> list at sourceforge, and ask them there,
				and if you've been able to create some nice, useful script, you can contribute it back to PyDev by creating a bug and
				attaching your script there.
			</li>
		</ul>
	</p>

	<br/>
	<p>
		So, that's it... Happy Scripting,<br/><br/>
		Fabio
	</p>
	
	<br/><br/>
	<p>
		<strong>Resources</strong> (links to github)<br/>
		<ul>
			<li>
				<strong><a href="http://github.com/aptana/Pydev/blob/f742ccc87a78a0dbf5fcd618561b3a91cdfbf5f5/plugins/org.python.pydev/src/org/python/pydev/editor/PyEdit.java">PyEdit.java</a></strong>
			</li>
			<li>
				<strong><a href="http://github.com/aptana/Pydev/tree/f742ccc87a78a0dbf5fcd618561b3a91cdfbf5f5/plugins/org.python.pydev.jython/jysrc">org.python.pydev.jythor/jysrc</a></strong>
			</li>
			<li>
				<strong><a href="http://github.com/aptana/Pydev/blob/f742ccc87a78a0dbf5fcd618561b3a91cdfbf5f5/plugins/org.python.pydev/src/org/python/pydev/editor/IPyEditListener.java">IPyEditListener.java</a></strong>
			</li>
			<li>
				<strong><a href="http://github.com/aptana/Pydev/blob/f742ccc87a78a0dbf5fcd618561b3a91cdfbf5f5/plugins/org.python.pydev/src/org/python/pydev/editor/scripting/PyEditScripting.java">PyEditScripting.java</a></strong>
			</li>
			<li>
				<strong><a href="http://github.com/aptana/Pydev/blob/f742ccc87a78a0dbf5fcd618561b3a91cdfbf5f5/plugins/org.python.pydev.jython/jysrc/pyedit_example.py">pyedit_example.py</a></strong>
			</li>
			<li>
				<strong><a href="http://github.com/aptana/Pydev/blob/f742ccc87a78a0dbf5fcd618561b3a91cdfbf5f5/plugins/org.python.pydev.jython/jysrc/pyedit_example2.py">pyedit_example2.py</a></strong>
			</li>
			<li>
				<strong><a href="http://github.com/aptana/Pydev/blob/f742ccc87a78a0dbf5fcd618561b3a91cdfbf5f5/plugins/org.python.pydev.jython/jysrc/pyedit_wrap_paragraph.py">pyedit_wrap_paragraph.py</a></strong>
			</li>
		</ul>
		
	</p>
</contents_area>



<right_area>
<p></p>
</right_area>


<image_area>manual.png</image_area>


<quote_area><strong>PyDev 101</strong></quote_area>

<root>manual_adv_features</root>
</doc>